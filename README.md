# Node.js分布式服务

本项目主要是简单的模拟了分布式注册中心和分布式服务，希望相关理念可以帮助到大家。

所有的数据交互都通过Http post的方式实现数据的交互。

dsf-server实现了一个简单的注册中心：  
* Y 提供全量服务查询的功能。
* Y 提供服务上线，以及通知服务消费方。
* Y 提供服务下线，以及通知服务消费方。
* Y 提供服务的不可用报告。
* Y 提供客户端程序心跳检查。
* Y 提供检测服务提供者是否存活。
* N 提供服务不可用的时候，备份注册中心通知客户端注册到备份的服务上面。
* Y 可配置的文件。

dsf-client实现了客户端程序：  
* Y 启动初始化本地服务和远程服务。
* Y 注册服务到注册中心，同时获取需要消费的服务。
* Y 提供获取当前客户端的状态信息。
* Y 提供监听注册中心变化的处理。
* Y 服务提供者的本地调用接口。
* Y 定时检测服务中心是否存在。
* Y 服务消费者的远程调用封装。
* Y 可配置的文件。

## 快速上手

### 第一步
启动dsf的注册中心
```shell
npm run s
```

### 第二步
启动客户端程序，可以多启动几个客户端，默认调度算法使用了轮询，可以自行扩展实现其他算法。
```shell
npm run t
```

### 第三步
启动调用程序
```shell
npm run o
```

### 验证服务调用

在本地启动postman工具，使用post方法
调用下面的接口，端口根据你的客户端而定。
```txt
http://127.0.0.1:6178/dsf/service/com.oeli.hello/1.0/say
```
或者控制台
```shell
curl --location --request POST '127.0.0.1:6178/dsf/service/com.oeli.hello/1.0/say' \
--header 'Content-Type: application/json' \
--data-raw '[
    "you don't have any collections"
]'
```
观察控制台的输出

也可访问http接口，使用get方法
```txt
http://127.0.0.1:6178/test/hello?word=EasyNodeRPC
```


## 基础介绍
我们如何编写自己的业务逻辑呢？

1、可以参考example\appone路径下面的代码，其中interface是需要用到的接口，service是提供的服务接口，http是提供个人的http服务。
在其他的地方是可以直接引用interface和service的代码。

2.配置文件可以参考dsf-client\config\application.js，复制这个配置文件指定个人的目录，并且可以参考example\appone\start.sh
进行启动项目。

3.目前框架的远程只支持HTTP+JSON的方式进行交互，同时服务可选择的配置也很简单，后续有需要可以扩展。



希望你会喜欢这种开发模式！！！！！


## 有趣的话题

### 为什么我要做这个项目？
因为我在学习dubbo啊，然后看到nodejs也有，然后就去试用【dubbo-js】了一下，断断续续花了几周
按照他的教程都没有跑起来，我很生气，所有我就是抱着研究的态度，按照自己的理解倒腾了这个东西，
另一个方面是我不太喜欢ts--js就是要灵活，要骚才行！！！

### 如何实现类似Java的接口呢？
习惯了java编程，面向接口编程还是挺爽的，但是js似乎就不存在这个东西，更重要的是AOP如何实现，
同时在js里面想要vscode里面让代码提示变得友好，只有你先把对应的对象声明写出来才行。最后我在
看了一些博客之后我有了一个大胆的想法，模拟Java的做法一个文件定义一个接口的做法，在程序启动
的时候我扫描这些程序中类型为函数的，再动态重新实现这些方法，静态代码提示友好，动态改变程序
运行时使用远程调用服务，js的灵活让我这种想法变得得以实现，这么做得好处是不用想js实现AOP的
各种骚操作，原理简单而美好。
